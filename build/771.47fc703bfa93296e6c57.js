"use strict";(self.webpackChunkpayload_template_js_blank=self.webpackChunkpayload_template_js_blank||[]).push([[771],{59771:(e,a,l)=>{l.r(a),l.d(a,{default:()=>h});var t=l(67294),i=l(16550),s=l(9980),o=l(28630),n=l(75091),d=l(47489),r=l(2143),u=l(88348),c=l(83780);const f=(e,a)=>a?e.fields.filter((e=>(0,c.fieldAffectsData)(e)&&"id"!==e.name||!0)):e.fields;var p=l(19826),v=l(40684),m=l(45074),$=l(91455),b=l(30894);const h=e=>{var a,l,c;const{collection:h,isEditing:k}=e,{slug:E,labels:{plural:S},admin:{useAsTitle:g,components:{views:{Edit:w}={}}={}}={}}=h,[C]=(0,t.useState)((()=>f(h,k))),[_]=(0,t.useState)((()=>({...h,fields:C}))),[P,Z]=(0,t.useState)(),y=(0,v.bU)(),{serverURL:L,routes:{admin:U,api:j}}=(0,s.Z)(),{params:{id:A}={}}=(0,i.$B)(),{state:D}=(0,i.TH)(),N=(0,i.k6)(),{setStepNav:R}=(0,n.FP)(),[T,x]=(0,t.useState)(),{permissions:B,user:F}=(0,o.a)(),{getVersions:G,preferencesKey:H}=(0,m.x5)(),{getPreference:K}=(0,$.G)(),V=(0,t.useCallback)((async e=>{var a;if(G(),k){const a=await(0,p.Z)({fieldSchema:_.fields,data:e.doc,user:F,id:A,operation:"update",locale:y});x(a)}else Z(`${U}/collections/${_.slug}/${null===(a=null==e?void 0:e.doc)||void 0===a?void 0:a.id}`)}),[U,_,k,G,F,A,y]),[{data:q,isLoading:z,isError:I}]=(0,d.Z)(k?`${L}${j}/${E}/${A}`:null,{initialParams:{"fallback-locale":"null",depth:0,draft:"true"}}),J=(null==D?void 0:D.data)||q;if((0,t.useEffect)((()=>{const e=[{url:`${U}/collections/${E}`,label:S}];if(k){let a="";J&&(a=g?J[g]?J[g]:"[Untitled]":J.id),e.push({label:a})}else e.push({label:"Create New"});R(e)}),[R,k,S,J,E,g,U]),(0,t.useEffect)((()=>{if(z)return;(async()=>{const e=await(0,p.Z)({fieldSchema:C,data:J,user:F,operation:k?"update":"create",id:A,locale:y});await K(H),x(e)})()}),[J,C,k,A,F,y,z,H,K]),(0,t.useEffect)((()=>{P&&N.push(P)}),[N,P]),I)return t.createElement(i.l_,{to:`${U}/not-found`});const M=null===(a=null==B?void 0:B.collections)||void 0===a?void 0:a[E],O=`${L}${j}/${E}/${A}${_.versions.drafts?"?draft=true":""}`,Q=`${L}${j}/${E}${k?`/${A}`:""}?locale=${y}&depth=0&fallback-locale=null`,W=k&&(null===(l=null==M?void 0:M.update)||void 0===l?void 0:l.permission)||!k&&(null===(c=null==M?void 0:M.create)||void 0===c?void 0:c.permission);return t.createElement(b.f.Provider,{value:1},t.createElement(r.Z,{DefaultComponent:u.Z,CustomComponent:w,componentProps:{id:A,isLoading:!T,data:J,collection:_,permissions:M,isEditing:k,onSave:V,initialState:T,hasSavePermission:W,apiURL:O,action:Q}}))}}}]);